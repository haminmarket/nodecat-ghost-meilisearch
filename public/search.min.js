!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).GhostMeilisearchSearch=e()}(this,(function(){"use strict";class t extends Error{name="MeiliSearchError";constructor(...t){super(...t)}}class e extends t{name="MeiliSearchApiError";cause;response;constructor(t,e){super(e?.message??`${t.status}: ${t.statusText}`),this.response=t,void 0!==e&&(this.cause=e)}}class s extends t{name="MeiliSearchRequestError";constructor(t,e){super(`Request to ${t} has failed`,{cause:e})}}class i extends t{name="MeiliSearchTimeOutError";constructor(t){super(t)}}function n(t,e){return`${t}\nHint: It might not be working because maybe you're not up to date with the Meilisearch version that ${e} call requires.`}function a(t){return Object.entries(t).reduce(((t,e)=>{const[s,i]=e;return void 0!==i&&(t[s]=i),t}),{})}async function r(t){return await new Promise((e=>setTimeout(e,t)))}function c(t){return Object.keys(t).reduce(((e,s)=>{const i=t[s];return void 0===i?e:Array.isArray(i)?{...e,[s]:i.join(",")}:i instanceof Date?{...e,[s]:i.toISOString()}:{...e,[s]:i}}),{})}function h(e){const s="X-Meilisearch-Client",i="Meilisearch JavaScript (v0.49.0)",n="Authorization",a=function(t){if(Array.isArray(t))return t.reduce(((t,e)=>(t[e[0]]=e[1],t)),{});if("has"in t){const e={};return t.forEach(((t,s)=>e[s]=t)),e}return Object.assign({},t)}(e.requestConfig?.headers??{});if(e.apiKey&&!a[n]&&(a[n]=`Bearer ${e.apiKey}`),a["Content-Type"]||(a["Content-Type"]="application/json"),e.clientAgents&&Array.isArray(e.clientAgents)){const t=e.clientAgents.concat(i);a[s]=t.join(" ; ")}else{if(e.clientAgents&&!Array.isArray(e.clientAgents))throw new t(`Meilisearch: The header "${s}" should be an array of string(s).\n`);a[s]=i}return a}class o{headers;url;requestConfig;httpClient;requestTimeout;constructor(e){this.headers=h(e),this.requestConfig=e.requestConfig,this.httpClient=e.httpClient,this.requestTimeout=e.timeout;try{const s=function(e){try{return(s=e=function(t){return t.startsWith("https://")||t.startsWith("http://")?t:`http://${t}`}(e)).endsWith("/")||(s+="/"),e=s}catch{throw new t("The provided host is not valid.")}var s}(e.host);this.url=new URL(s)}catch{throw new t("The provided host is not valid.")}}async request({method:t,url:i,params:n,body:a,config:r={}}){const c=new URL(i,this.url);if(n){const t=new URLSearchParams;Object.keys(n).filter((t=>null!==n[t])).map((e=>t.set(e,n[e]))),c.search=t.toString()}r.headers?.["Content-Type"]||(a=JSON.stringify(a));const h={...this.headers,...r.headers},o=this.fetchWithTimeout(c.toString(),{...r,...this.requestConfig,method:t,body:a,headers:h},this.requestTimeout),u=await o.catch((t=>{throw new s(c.toString(),t)}));if(void 0!==this.httpClient)return u;const d=await u.text(),l=""===d?void 0:JSON.parse(d);if(!u.ok)throw new e(u,l);return l}async fetchWithTimeout(t,e,s){return new Promise(((i,n)=>{const a=[(this.httpClient?this.httpClient:fetch)(t,e)];let r;if(s){const t=new Promise(((t,e)=>{r=setTimeout((()=>{e(new Error("Error: Request Timed Out"))}),s)}));a.push(t)}Promise.race(a).then(i).catch(n).finally((()=>{clearTimeout(r)}))}))}async get(t,e,s){return await this.request({method:"GET",url:t,params:e,config:s})}async post(t,e,s,i){return await this.request({method:"POST",url:t,body:e,params:s,config:i})}async put(t,e,s,i){return await this.request({method:"PUT",url:t,body:e,params:s,config:i})}async patch(t,e,s,i){return await this.request({method:"PATCH",url:t,body:e,params:s,config:i})}async delete(t,e,s,i){return await this.request({method:"DELETE",url:t,body:e,params:s,config:i})}}class u{taskUid;indexUid;status;type;enqueuedAt;constructor(t){this.taskUid=t.taskUid,this.indexUid=t.indexUid,this.status=t.status,this.type=t.type,this.enqueuedAt=new Date(t.enqueuedAt)}}class d{indexUid;status;type;uid;batchUid;canceledBy;details;error;duration;startedAt;enqueuedAt;finishedAt;constructor(t){this.indexUid=t.indexUid,this.status=t.status,this.type=t.type,this.uid=t.uid,this.batchUid=t.batchUid,this.details=t.details,this.canceledBy=t.canceledBy,this.error=t.error,this.duration=t.duration,this.startedAt=new Date(t.startedAt),this.enqueuedAt=new Date(t.enqueuedAt),this.finishedAt=new Date(t.finishedAt)}}class l{httpRequest;constructor(t){this.httpRequest=new o(t)}async getTask(t){const e=`tasks/${t}`,s=await this.httpRequest.get(e);return new d(s)}async getTasks(t={}){const e=await this.httpRequest.get("tasks",c(t));return{...e,results:e.results.map((t=>new d(t)))}}async waitForTask(t,{timeOutMs:e=5e3,intervalMs:s=50}={}){const n=Date.now();for(;Date.now()-n<e;){const e=await this.getTask(t);if(![g.TASK_ENQUEUED,g.TASK_PROCESSING].includes(e.status))return e;await r(s)}throw new i(`timeout of ${e}ms has exceeded on process ${t} when waiting a task to be resolved.`)}async waitForTasks(t,{timeOutMs:e=5e3,intervalMs:s=50}={}){const i=[];for(const n of t){const t=await this.waitForTask(n,{timeOutMs:e,intervalMs:s});i.push(t)}return i}async cancelTasks(t={}){const e=await this.httpRequest.post("tasks/cancel",{},c(t));return new u(e)}async deleteTasks(t={}){const e=await this.httpRequest.delete("tasks",{},c(t));return new u(e)}}class p{uid;details;stats;startedAt;finishedAt;duration;progress;constructor(t){this.uid=t.uid,this.details=t.details,this.stats=t.stats,this.startedAt=t.startedAt,this.finishedAt=t.finishedAt,this.duration=t.duration,this.progress=t.progress}}class m{httpRequest;constructor(t){this.httpRequest=new o(t)}async getBatch(t){const e=`batches/${t}`,s=await this.httpRequest.get(e);return new p(s)}async getBatches(t={}){const e=await this.httpRequest.get("batches",c(t));return{...e,results:e.results.map((t=>new p(t)))}}}const g={TASK_PROCESSING:"processing",TASK_ENQUEUED:"enqueued"},y="index_not_found";class w{uid;primaryKey;createdAt;updatedAt;httpRequest;tasks;constructor(t,e,s){this.uid=e,this.primaryKey=s,this.httpRequest=new o(t),this.tasks=new l(t)}async search(t,e,s){const i=`indexes/${this.uid}/search`;return await this.httpRequest.post(i,a({q:t,...e}),void 0,s)}async searchGet(e,s,i){const n=`indexes/${this.uid}/search`,r={q:e,...s,filter:(e=>{if("string"==typeof e)return e;if(Array.isArray(e))throw new t("The filter query parameter should be in string format when using searchGet")})(s?.filter),sort:s?.sort?.join(","),facets:s?.facets?.join(","),attributesToRetrieve:s?.attributesToRetrieve?.join(","),attributesToCrop:s?.attributesToCrop?.join(","),attributesToHighlight:s?.attributesToHighlight?.join(","),vector:s?.vector?.join(","),attributesToSearchOn:s?.attributesToSearchOn?.join(",")};return await this.httpRequest.get(n,a(r),i)}async searchForFacetValues(t,e){const s=`indexes/${this.uid}/facet-search`;return await this.httpRequest.post(s,a(t),void 0,e)}async searchSimilarDocuments(t){const e=`indexes/${this.uid}/similar`;return await this.httpRequest.post(e,a(t),void 0)}async getRawInfo(){const t=`indexes/${this.uid}`,e=await this.httpRequest.get(t);return this.primaryKey=e.primaryKey,this.updatedAt=new Date(e.updatedAt),this.createdAt=new Date(e.createdAt),e}async fetchInfo(){return await this.getRawInfo(),this}async fetchPrimaryKey(){return this.primaryKey=(await this.getRawInfo()).primaryKey,this.primaryKey}static async create(t,e={},s){const i=new o(s),n=await i.post("indexes",{...e,uid:t});return new u(n)}async update(t){const e=`indexes/${this.uid}`,s=await this.httpRequest.patch(e,t);return s.enqueuedAt=new Date(s.enqueuedAt),s}async delete(){const t=`indexes/${this.uid}`,e=await this.httpRequest.delete(t);return new u(e)}async getTasks(t={}){return await this.tasks.getTasks({...t,indexUids:[this.uid]})}async getTask(t){return await this.tasks.getTask(t)}async waitForTasks(t,{timeOutMs:e=5e3,intervalMs:s=50}={}){return await this.tasks.waitForTasks(t,{timeOutMs:e,intervalMs:s})}async waitForTask(t,{timeOutMs:e=5e3,intervalMs:s=50}={}){return await this.tasks.waitForTask(t,{timeOutMs:e,intervalMs:s})}async getStats(){const t=`indexes/${this.uid}/stats`;return await this.httpRequest.get(t)}async getDocuments(t={}){if(void 0===(t=a(t)).filter){const e=`indexes/${this.uid}/documents`,s=Array.isArray(t?.fields)?{fields:t?.fields?.join(",")}:{};return await this.httpRequest.get(e,{...t,...s})}try{const e=`indexes/${this.uid}/documents/fetch`;return await this.httpRequest.post(e,t)}catch(t){throw(t instanceof s||t instanceof e)&&(t.message=n(t.message,"getDocuments")),t}}async getDocument(t,e){const s=`indexes/${this.uid}/documents/${t}`,i=(()=>{if(Array.isArray(e?.fields))return e?.fields?.join(",")})();return await this.httpRequest.get(s,a({...e,fields:i}))}async addDocuments(t,e){const s=`indexes/${this.uid}/documents`,i=await this.httpRequest.post(s,t,e);return new u(i)}async addDocumentsFromString(t,e,s){const i=`indexes/${this.uid}/documents`,n=await this.httpRequest.post(i,t,s,{headers:{"Content-Type":e}});return new u(n)}async addDocumentsInBatches(t,e=1e3,s){const i=[];for(let n=0;n<t.length;n+=e)i.push(await this.addDocuments(t.slice(n,n+e),s));return i}async updateDocuments(t,e){const s=`indexes/${this.uid}/documents`,i=await this.httpRequest.put(s,t,e);return new u(i)}async updateDocumentsInBatches(t,e=1e3,s){const i=[];for(let n=0;n<t.length;n+=e)i.push(await this.updateDocuments(t.slice(n,n+e),s));return i}async updateDocumentsFromString(t,e,s){const i=`indexes/${this.uid}/documents`,n=await this.httpRequest.put(i,t,s,{headers:{"Content-Type":e}});return new u(n)}async deleteDocument(t){const e=`indexes/${this.uid}/documents/${t}`,s=await this.httpRequest.delete(e);return s.enqueuedAt=new Date(s.enqueuedAt),s}async deleteDocuments(t){const i=!Array.isArray(t)&&"object"==typeof t,a=i?"documents/delete":"documents/delete-batch",r=`indexes/${this.uid}/${a}`;try{const e=await this.httpRequest.post(r,t);return new u(e)}catch(t){throw(t instanceof s&&i||t instanceof e)&&(t.message=n(t.message,"deleteDocuments")),t}}async deleteAllDocuments(){const t=`indexes/${this.uid}/documents`,e=await this.httpRequest.delete(t);return e.enqueuedAt=new Date(e.enqueuedAt),e}async updateDocumentsByFunction(t){const e=`indexes/${this.uid}/documents/edit`,s=await this.httpRequest.post(e,t);return new u(s)}async getSettings(){const t=`indexes/${this.uid}/settings`;return await this.httpRequest.get(t)}async updateSettings(t){const e=`indexes/${this.uid}/settings`,s=await this.httpRequest.patch(e,t);return s.enqueued=new Date(s.enqueuedAt),s}async resetSettings(){const t=`indexes/${this.uid}/settings`,e=await this.httpRequest.delete(t);return e.enqueuedAt=new Date(e.enqueuedAt),e}async getPagination(){const t=`indexes/${this.uid}/settings/pagination`;return await this.httpRequest.get(t)}async updatePagination(t){const e=`indexes/${this.uid}/settings/pagination`,s=await this.httpRequest.patch(e,t);return new u(s)}async resetPagination(){const t=`indexes/${this.uid}/settings/pagination`,e=await this.httpRequest.delete(t);return new u(e)}async getSynonyms(){const t=`indexes/${this.uid}/settings/synonyms`;return await this.httpRequest.get(t)}async updateSynonyms(t){const e=`indexes/${this.uid}/settings/synonyms`,s=await this.httpRequest.put(e,t);return new u(s)}async resetSynonyms(){const t=`indexes/${this.uid}/settings/synonyms`,e=await this.httpRequest.delete(t);return e.enqueuedAt=new Date(e.enqueuedAt),e}async getStopWords(){const t=`indexes/${this.uid}/settings/stop-words`;return await this.httpRequest.get(t)}async updateStopWords(t){const e=`indexes/${this.uid}/settings/stop-words`,s=await this.httpRequest.put(e,t);return new u(s)}async resetStopWords(){const t=`indexes/${this.uid}/settings/stop-words`,e=await this.httpRequest.delete(t);return e.enqueuedAt=new Date(e.enqueuedAt),e}async getRankingRules(){const t=`indexes/${this.uid}/settings/ranking-rules`;return await this.httpRequest.get(t)}async updateRankingRules(t){const e=`indexes/${this.uid}/settings/ranking-rules`,s=await this.httpRequest.put(e,t);return new u(s)}async resetRankingRules(){const t=`indexes/${this.uid}/settings/ranking-rules`,e=await this.httpRequest.delete(t);return e.enqueuedAt=new Date(e.enqueuedAt),e}async getDistinctAttribute(){const t=`indexes/${this.uid}/settings/distinct-attribute`;return await this.httpRequest.get(t)}async updateDistinctAttribute(t){const e=`indexes/${this.uid}/settings/distinct-attribute`,s=await this.httpRequest.put(e,t);return new u(s)}async resetDistinctAttribute(){const t=`indexes/${this.uid}/settings/distinct-attribute`,e=await this.httpRequest.delete(t);return e.enqueuedAt=new Date(e.enqueuedAt),e}async getFilterableAttributes(){const t=`indexes/${this.uid}/settings/filterable-attributes`;return await this.httpRequest.get(t)}async updateFilterableAttributes(t){const e=`indexes/${this.uid}/settings/filterable-attributes`,s=await this.httpRequest.put(e,t);return new u(s)}async resetFilterableAttributes(){const t=`indexes/${this.uid}/settings/filterable-attributes`,e=await this.httpRequest.delete(t);return e.enqueuedAt=new Date(e.enqueuedAt),e}async getSortableAttributes(){const t=`indexes/${this.uid}/settings/sortable-attributes`;return await this.httpRequest.get(t)}async updateSortableAttributes(t){const e=`indexes/${this.uid}/settings/sortable-attributes`,s=await this.httpRequest.put(e,t);return new u(s)}async resetSortableAttributes(){const t=`indexes/${this.uid}/settings/sortable-attributes`,e=await this.httpRequest.delete(t);return e.enqueuedAt=new Date(e.enqueuedAt),e}async getSearchableAttributes(){const t=`indexes/${this.uid}/settings/searchable-attributes`;return await this.httpRequest.get(t)}async updateSearchableAttributes(t){const e=`indexes/${this.uid}/settings/searchable-attributes`,s=await this.httpRequest.put(e,t);return new u(s)}async resetSearchableAttributes(){const t=`indexes/${this.uid}/settings/searchable-attributes`,e=await this.httpRequest.delete(t);return e.enqueuedAt=new Date(e.enqueuedAt),e}async getDisplayedAttributes(){const t=`indexes/${this.uid}/settings/displayed-attributes`;return await this.httpRequest.get(t)}async updateDisplayedAttributes(t){const e=`indexes/${this.uid}/settings/displayed-attributes`,s=await this.httpRequest.put(e,t);return new u(s)}async resetDisplayedAttributes(){const t=`indexes/${this.uid}/settings/displayed-attributes`,e=await this.httpRequest.delete(t);return e.enqueuedAt=new Date(e.enqueuedAt),e}async getTypoTolerance(){const t=`indexes/${this.uid}/settings/typo-tolerance`;return await this.httpRequest.get(t)}async updateTypoTolerance(t){const e=`indexes/${this.uid}/settings/typo-tolerance`,s=await this.httpRequest.patch(e,t);return s.enqueuedAt=new Date(s.enqueuedAt),s}async resetTypoTolerance(){const t=`indexes/${this.uid}/settings/typo-tolerance`,e=await this.httpRequest.delete(t);return e.enqueuedAt=new Date(e.enqueuedAt),e}async getFaceting(){const t=`indexes/${this.uid}/settings/faceting`;return await this.httpRequest.get(t)}async updateFaceting(t){const e=`indexes/${this.uid}/settings/faceting`,s=await this.httpRequest.patch(e,t);return new u(s)}async resetFaceting(){const t=`indexes/${this.uid}/settings/faceting`,e=await this.httpRequest.delete(t);return new u(e)}async getSeparatorTokens(){const t=`indexes/${this.uid}/settings/separator-tokens`;return await this.httpRequest.get(t)}async updateSeparatorTokens(t){const e=`indexes/${this.uid}/settings/separator-tokens`,s=await this.httpRequest.put(e,t);return new u(s)}async resetSeparatorTokens(){const t=`indexes/${this.uid}/settings/separator-tokens`,e=await this.httpRequest.delete(t);return e.enqueuedAt=new Date(e.enqueuedAt),e}async getNonSeparatorTokens(){const t=`indexes/${this.uid}/settings/non-separator-tokens`;return await this.httpRequest.get(t)}async updateNonSeparatorTokens(t){const e=`indexes/${this.uid}/settings/non-separator-tokens`,s=await this.httpRequest.put(e,t);return new u(s)}async resetNonSeparatorTokens(){const t=`indexes/${this.uid}/settings/non-separator-tokens`,e=await this.httpRequest.delete(t);return e.enqueuedAt=new Date(e.enqueuedAt),e}async getDictionary(){const t=`indexes/${this.uid}/settings/dictionary`;return await this.httpRequest.get(t)}async updateDictionary(t){const e=`indexes/${this.uid}/settings/dictionary`,s=await this.httpRequest.put(e,t);return new u(s)}async resetDictionary(){const t=`indexes/${this.uid}/settings/dictionary`,e=await this.httpRequest.delete(t);return e.enqueuedAt=new Date(e.enqueuedAt),e}async getProximityPrecision(){const t=`indexes/${this.uid}/settings/proximity-precision`;return await this.httpRequest.get(t)}async updateProximityPrecision(t){const e=`indexes/${this.uid}/settings/proximity-precision`,s=await this.httpRequest.put(e,t);return new u(s)}async resetProximityPrecision(){const t=`indexes/${this.uid}/settings/proximity-precision`,e=await this.httpRequest.delete(t);return e.enqueuedAt=new Date(e.enqueuedAt),e}async getEmbedders(){const t=`indexes/${this.uid}/settings/embedders`;return await this.httpRequest.get(t)}async updateEmbedders(t){const e=`indexes/${this.uid}/settings/embedders`,s=await this.httpRequest.patch(e,t);return new u(s)}async resetEmbedders(){const t=`indexes/${this.uid}/settings/embedders`,e=await this.httpRequest.delete(t);return e.enqueuedAt=new Date(e.enqueuedAt),e}async getSearchCutoffMs(){const t=`indexes/${this.uid}/settings/search-cutoff-ms`;return await this.httpRequest.get(t)}async updateSearchCutoffMs(t){const e=`indexes/${this.uid}/settings/search-cutoff-ms`,s=await this.httpRequest.put(e,t);return new u(s)}async resetSearchCutoffMs(){const t=`indexes/${this.uid}/settings/search-cutoff-ms`,e=await this.httpRequest.delete(t);return new u(e)}async getLocalizedAttributes(){const t=`indexes/${this.uid}/settings/localized-attributes`;return await this.httpRequest.get(t)}async updateLocalizedAttributes(t){const e=`indexes/${this.uid}/settings/localized-attributes`,s=await this.httpRequest.put(e,t);return new u(s)}async resetLocalizedAttributes(){const t=`indexes/${this.uid}/settings/localized-attributes`,e=await this.httpRequest.delete(t);return new u(e)}async getFacetSearch(){const t=`indexes/${this.uid}/settings/facet-search`;return await this.httpRequest.get(t)}async updateFacetSearch(t){const e=`indexes/${this.uid}/settings/facet-search`,s=await this.httpRequest.put(e,t);return new u(s)}async resetFacetSearch(){const t=`indexes/${this.uid}/settings/facet-search`,e=await this.httpRequest.delete(t);return new u(e)}async getPrefixSearch(){const t=`indexes/${this.uid}/settings/prefix-search`;return await this.httpRequest.get(t)}async updatePrefixSearch(t){const e=`indexes/${this.uid}/settings/prefix-search`,s=await this.httpRequest.put(e,t);return new u(s)}async resetPrefixSearch(){const t=`indexes/${this.uid}/settings/prefix-search`,e=await this.httpRequest.delete(t);return new u(e)}}class f{config;httpRequest;tasks;batches;constructor(t){this.config=t,this.httpRequest=new o(t),this.tasks=new l(t),this.batches=new m(t)}index(t){return new w(this.config,t)}async getIndex(t){return new w(this.config,t).fetchInfo()}async getRawIndex(t){return new w(this.config,t).getRawInfo()}async getIndexes(t={}){const e=await this.getRawIndexes(t),s=e.results.map((t=>new w(this.config,t.uid,t.primaryKey)));return{...e,results:s}}async getRawIndexes(t={}){return await this.httpRequest.get("indexes",t)}async createIndex(t,e={}){return await w.create(t,e,this.config)}async updateIndex(t,e={}){return await new w(this.config,t).update(e)}async deleteIndex(t){return await new w(this.config,t).delete()}async deleteIndexIfExists(t){try{return await this.deleteIndex(t),!0}catch(t){if(t.code===y)return!1;throw t}}async swapIndexes(t){return await this.httpRequest.post("/swap-indexes",t)}async multiSearch(t,e){return await this.httpRequest.post("multi-search",t,void 0,e)}async getTasks(t={}){return await this.tasks.getTasks(t)}async getTask(t){return await this.tasks.getTask(t)}async waitForTasks(t,{timeOutMs:e=5e3,intervalMs:s=50}={}){return await this.tasks.waitForTasks(t,{timeOutMs:e,intervalMs:s})}async waitForTask(t,{timeOutMs:e=5e3,intervalMs:s=50}={}){return await this.tasks.waitForTask(t,{timeOutMs:e,intervalMs:s})}async cancelTasks(t){return await this.tasks.cancelTasks(t)}async deleteTasks(t={}){return await this.tasks.deleteTasks(t)}async getBatches(t={}){return await this.batches.getBatches(t)}async getBatch(t){return await this.batches.getBatch(t)}async getKeys(t={}){const e=await this.httpRequest.get("keys",t);return e.results=e.results.map((t=>({...t,createdAt:new Date(t.createdAt),updatedAt:new Date(t.updatedAt)}))),e}async getKey(t){const e=`keys/${t}`;return await this.httpRequest.get(e)}async createKey(t){return await this.httpRequest.post("keys",t)}async updateKey(t,e){const s=`keys/${t}`;return await this.httpRequest.patch(s,e)}async deleteKey(t){const e=`keys/${t}`;return await this.httpRequest.delete(e)}async health(){return await this.httpRequest.get("health")}async isHealthy(){try{const t="health";return await this.httpRequest.get(t),!0}catch{return!1}}async getStats(){return await this.httpRequest.get("stats")}async getVersion(){return await this.httpRequest.get("version")}async createDump(){const t=await this.httpRequest.post("dumps");return new u(t)}async createSnapshot(){const t=await this.httpRequest.post("snapshots");return new u(t)}}class q{constructor(t={}){this.config={meilisearchHost:null,meilisearchApiKey:null,indexName:null,commonSearches:[],theme:"system",enableHighlighting:!0,searchFields:{title:{weight:5,highlight:!0},plaintext:{weight:4,highlight:!0},excerpt:{weight:3,highlight:!0},html:{weight:1,highlight:!0}},enableAiSearch:!1,aiSearchEmbedder:null,aiSearchLimit:3,...t},this.state={isOpen:!1,query:"",normalResults:[],aiResults:[],loading:!1,selectedIndex:-1,error:null},this.client=new f({host:this.config.meilisearchHost,apiKey:this.config.meilisearchApiKey}),this.index=this.client.index(this.config.indexName),this.createDOMElements(),this.applyTheme(),this.setupColorSchemeObserver(),this.addEventListeners(),this.populateCommonSearches(),this.adjustModalForScreenSize()}createDOMElements(){this.wrapper=document.createElement("div"),this.wrapper.id="ms-search-wrapper",document.body.appendChild(this.wrapper),this.modal=document.createElement("div"),this.modal.id="ms-search-modal",this.modal.classList.add("hidden"),this.wrapper.appendChild(this.modal),this.modal.innerHTML='\n      <div class="ms-backdrop"></div>\n      <div class="ms-modal-container">\n        <button class="ms-close-button" aria-label="Close search">&times;</button>\n        <div class="ms-modal-content">\n          <div class="ms-search-header">\n            <input type="text" class="ms-search-input" placeholder="Search..." aria-label="Search">\n          </div>\n          <div class="ms-keyboard-hints">\n            <span><span class="ms-kbd">↑</span><span class="ms-kbd">↓</span> to navigate</span>\n            <span><span class="ms-kbd">↵</span> to select</span>\n            <span><span class="ms-kbd">ESC</span> to close</span>\n          </div>\n          <div class="ms-results-container">\n            <div class="ms-common-searches">\n              <div class="ms-common-searches-title">Common searches</div>\n              <div class="ms-common-searches-list"></div>\n            </div>\n            <div class="ms-ai-results-section hidden">\n              <div class="ms-results-section-title">AI Suggestions</div>\n              <ul class="ms-ai-hits-list"></ul>\n            </div>\n            <div class="ms-normal-results-section">\n              <div class="ms-results-section-title">Keyword Matches</div>\n              <ul class="ms-normal-hits-list"></ul>\n            </div>\n            <div class="ms-loading-state">\n              <div class="ms-loading-spinner"></div>\n              <div>Searching...</div>\n            </div>\n            <div class="ms-empty-state">\n              <div class="ms-empty-message">No results found for your search.</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    ',this.searchInput=this.modal.querySelector(".ms-search-input"),this.closeButton=this.modal.querySelector(".ms-close-button"),this.aiResultsSection=this.modal.querySelector(".ms-ai-results-section"),this.aiHitsList=this.modal.querySelector(".ms-ai-hits-list"),this.normalResultsSection=this.modal.querySelector(".ms-normal-results-section"),this.normalHitsList=this.modal.querySelector(".ms-normal-hits-list"),this.loadingState=this.modal.querySelector(".ms-loading-state"),this.emptyState=this.modal.querySelector(".ms-empty-state"),this.commonSearchesList=this.modal.querySelector(".ms-common-searches-list"),this.commonSearchesSection=this.modal.querySelector(".ms-common-searches"),this.populateCommonSearches(),this.applyTheme()}populateCommonSearches(){this.config.commonSearches&&0!==this.config.commonSearches.length?(this.commonSearchesList.innerHTML="",this.config.commonSearches.forEach((t=>{const e=document.createElement("button");e.classList.add("ms-common-search-btn"),e.textContent=t,e.addEventListener("click",(()=>{this.searchInput.value=t,this.state.query=t,this.performSearch()})),this.commonSearchesList.appendChild(e)}))):this.commonSearchesSection.classList.add("hidden")}applyTheme(){const t=document.documentElement.getAttribute("data-color-scheme"),e=document.body.getAttribute("data-color-scheme"),s=t||e||this.config.theme;if(this.wrapper.classList.remove("dark","light"),"dark"===s)this.wrapper.classList.add("dark");else if("system"===s){window.matchMedia("(prefers-color-scheme: dark)").matches?this.wrapper.classList.add("dark"):this.wrapper.classList.add("light"),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(t=>{this.wrapper.classList.remove("dark","light"),t.matches?this.wrapper.classList.add("dark"):this.wrapper.classList.add("light")}))}else this.wrapper.classList.add("light");this.setupColorSchemeObserver()}setupColorSchemeObserver(){const t=new MutationObserver((t=>{t.forEach((t=>{"attributes"===t.type&&"data-color-scheme"===t.attributeName&&this.applyTheme()}))}));t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-color-scheme"]}),t.observe(document.body,{attributes:!0,attributeFilter:["data-color-scheme"]})}addEventListeners(){this.closeButton.addEventListener("click",(()=>this.close())),this.modal.querySelector(".ms-backdrop").addEventListener("click",(()=>this.close())),this.searchInput.addEventListener("input",(()=>{this.state.query=this.searchInput.value,this.performSearch()})),document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.querySelectorAll("[data-ghost-search]").forEach((t=>{t.addEventListener("click",(t=>{t.preventDefault(),this.open()}))})),document.addEventListener("keydown",(t=>{(t.metaKey||t.ctrlKey)&&"k"===t.key&&(t.preventDefault(),this.open()),"/"!==t.key||["INPUT","TEXTAREA"].includes(document.activeElement.tagName)||(t.preventDefault(),this.open())})),window.addEventListener("resize",(()=>{this.state.isOpen&&this.adjustModalForScreenSize()}))}handleKeyDown(t){if(this.state.isOpen)switch(t.key){case"Escape":t.preventDefault(),this.close();break;case"ArrowDown":t.preventDefault(),this.navigateResults(1);break;case"ArrowUp":t.preventDefault(),this.navigateResults(-1);break;case"Enter":t.preventDefault(),this.selectResult()}}adjustModalForScreenSize(){window.innerWidth<640?(this.modal.querySelector(".ms-modal-content").style.height="100vh",this.modal.querySelector(".ms-results-container").style.maxHeight="calc(100vh - 7rem)"):(this.modal.querySelector(".ms-modal-content").style.height="",this.modal.querySelector(".ms-results-container").style.maxHeight="")}navigateResults(t){const e=[...this.config.enableAiSearch?this.state.aiResults:[],...this.state.normalResults].length;if(0===e)return;let s=this.state.selectedIndex+t;s<0?s=e-1:s>=e&&(s=0),this.state.selectedIndex=s,this.updateSelectedResult()}updateSelectedResult(){const t=this.modal.querySelectorAll(".ms-result-link");if(t.forEach((t=>t.classList.remove("ms-selected"))),this.state.selectedIndex>=0&&this.state.selectedIndex<t.length){const e=t[this.state.selectedIndex];e.classList.add("ms-selected");const s=this.modal.querySelector(".ms-results-container"),i=e.offsetTop-s.offsetTop,n=i+e.offsetHeight,a=s.scrollTop,r=s.offsetHeight;i<a?s.scrollTop=i:n>a+r&&(s.scrollTop=n-r)}}selectResult(){const t=[...this.config.enableAiSearch?this.state.aiResults:[],...this.state.normalResults],e=t.length;if(0===e||this.state.selectedIndex<0||this.state.selectedIndex>=e)return;const s=t[this.state.selectedIndex];this.close();const i=s.url||(s.slug?`/${s.slug}`:null);i?setTimeout((()=>{window.location.href=i}),10):console.warn("Selected result has no URL or slug:",s)}open(){this.state.isOpen=!0,this.modal.classList.remove("hidden"),this.searchInput.focus(),""===this.state.query.trim()?(this.modal.querySelector(".ms-keyboard-hints").classList.add("hidden"),this.modal.querySelector(".ms-results-container").classList.add("ms-results-empty")):(this.modal.querySelector(".ms-keyboard-hints").classList.remove("hidden"),this.modal.querySelector(".ms-results-container").classList.remove("ms-results-empty")),document.body.style.overflow="hidden",this.adjustModalForScreenSize()}close(){this.state.isOpen=!1,this.modal.classList.add("hidden"),this.state.selectedIndex=-1,document.body.style.overflow=""}extractTextBetweenQuotes(t){if(!t)return null;const e=t.match(/"([^"]+)"/);return e?e[1]:null}async performSearch(){const t=this.state.query.trim();if(this.state.aiResults=[],this.state.normalResults=[],this.aiResultsSection.classList.add("hidden"),this.normalResultsSection.classList.remove("hidden"),""===t)return this.commonSearchesSection.classList.remove("hidden"),this.aiHitsList.innerHTML="",this.normalHitsList.innerHTML="",this.loadingState.classList.remove("active"),this.emptyState.classList.remove("active"),this.modal.querySelector(".ms-keyboard-hints").classList.add("hidden"),void this.modal.querySelector(".ms-results-container").classList.add("ms-results-empty");this.commonSearchesSection.classList.add("hidden"),this.modal.querySelector(".ms-keyboard-hints").classList.remove("hidden"),this.modal.querySelector(".ms-results-container").classList.remove("ms-results-empty"),this.state.loading=!0,this.loadingState.classList.add("active"),this.emptyState.classList.remove("active");try{const e={limit:100,attributesToHighlight:Object.entries(this.config.searchFields).filter((([t,e])=>e.highlight)).map((([t])=>t)),attributesToRetrieve:["title","url","excerpt","plaintext","tags","slug","visibility"],highlightPreTag:"<em>",highlightPostTag:"</em>"};let s,i=Promise.resolve({hits:[]});if(this.config.enableAiSearch&&this.config.aiSearchEmbedder){this.aiResultsSection.classList.remove("hidden");const n={...e,limit:this.config.aiSearchLimit,hybrid:{embedder:this.config.aiSearchEmbedder}};i=this.index.search(t,n);const a={...e,attributesToSearchOn:["title","plaintext","excerpt"],matchingStrategy:"last"};s=this.index.search(t,a)}else{this.aiResultsSection.classList.add("hidden");const i=t.startsWith('"')&&t.endsWith('"'),n=this.extractTextBetweenQuotes(t),a=i||null!==n,r={...e,attributesToSearchOn:["title","plaintext","excerpt"]};if(a){const e=i?t.slice(1,-1):n;r.matchingStrategy="all",s=this.index.search(e,r).then((t=>{if(t.hits.length>0){const s=e.toLowerCase(),i=t.hits.filter((t=>t.title&&t.title.toLowerCase().includes(s)||t.plaintext&&t.plaintext.toLowerCase().includes(s)||t.excerpt&&t.excerpt.toLowerCase().includes(s)));return{...t,hits:i}}return t}))}else r.matchingStrategy="last",s=this.index.search(t,r)}const[n,a]=await Promise.all([i,s]);this.state.loading=!1,this.state.aiResults=n.hits||[],this.state.normalResults=a.hits||[],this.state.selectedIndex=-1,this.state.error=null,this.renderResults(),this.loadingState.classList.remove("active"),0===this.state.aiResults.length&&0===this.state.normalResults.length&&(this.emptyState.classList.add("active"),this.emptyState.querySelector(".ms-empty-message").textContent="No results found for your search.")}catch(t){console.error("Search error:",t),this.state.loading=!1,this.state.error=t,this.state.aiResults=[],this.state.normalResults=[],this.loadingState.classList.remove("active"),this.aiResultsSection.classList.add("hidden"),this.emptyState.classList.add("active"),this.emptyState.querySelector(".ms-empty-message").textContent="An error occurred while searching. Please try again.",this.renderResults()}}renderResults(){this.aiHitsList.innerHTML="",this.normalHitsList.innerHTML="";const t=this.state.query.trim();this.config.enableAiSearch&&this.state.aiResults.length>0?(this.aiResultsSection.classList.remove("hidden"),this.state.aiResults.forEach((e=>{const s=this._createHitElement(e,t);this.aiHitsList.appendChild(s)}))):this.aiResultsSection.classList.add("hidden"),this.state.normalResults.length>0?(this.normalResultsSection.classList.remove("hidden"),this.state.normalResults.forEach((e=>{const s=this._createHitElement(e,t);this.normalHitsList.appendChild(s)}))):this.normalResultsSection.classList.remove("hidden"),this.updateSelectedResult()}_createHitElement(t,e){console.log("--- Processing Hit ---",JSON.stringify(t));const s=document.createElement("li"),i=t.visibility||"public";console.log("Determined visibility:",i);const n=(t,e)=>{if(!this.config.enableHighlighting||!e||0===e.length||!t)return t;let s=t;return e.forEach((t=>{try{const e=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=new RegExp(`(${e})`,"gi");s=s.replace(i,"<em>$1</em>")}catch(e){console.warn("Error highlighting term:",t,e)}})),s},a=e?e.split(/\s+/).filter((t=>t.length>=2)):[],r=document.createElement("a");t.url?r.href=t.url:t.slug?r.href=`/${t.slug}`:(r.href="#",r.style.pointerEvents="none"),r.classList.add("ms-result-link"),r.addEventListener("click",(t=>{"none"!==r.style.pointerEvents?(t.preventDefault(),this.close(),setTimeout((()=>{window.location.href=r.href}),10)):t.preventDefault()}));const c=document.createElement("div");c.classList.add("ms-result-item");const h=document.createElement("h3");h.classList.add("ms-result-title");let o=t.title||"Untitled";const u=document.createElement("p");u.classList.add("ms-result-excerpt");let d="";if("public"===i){const s=this.config.enableHighlighting&&(t._formatted?.title||t._highlightResult?.title?.value);o=s||n(o,a);let i=t.plaintext||t.excerpt||"";if(e&&this.config.enableHighlighting){const t=this.extractTextBetweenQuotes(e),s=e.startsWith('"')&&e.endsWith('"'),r=t||(s?e.slice(1,-1):null),c=r?[]:a.sort(((t,e)=>e.length-t.length));let h=-1,o=0;const u=i.toLowerCase();if(r){const t=r.toLowerCase(),e=u.indexOf(t);-1!==e&&(h=e,o=r.length)}else for(const t of c){const e=t.toLowerCase(),s=u.indexOf(e);-1!==s&&(-1===h||s<h)&&(h=s,o=t.length)}let l="";if(-1!==h){const t=60,e=Math.max(0,h-t),s=Math.min(i.length,h+o+t);l=i.substring(e,s),e>0&&(l="..."+l),s<i.length&&(l+="...")}else l=i.substring(0,150)+(i.length>150?"...":"");d=l;d=n(d,r?[r]:c)}else d=i.substring(0,150)+(i.length>150?"...":"")}else o=t.title||"Untitled",d=t.excerpt||"",o=n(o,a);return console.log("Final excerptContent before setting HTML:",d),h.innerHTML=o,u.innerHTML=d,u.innerHTML=d,c.appendChild(h),c.appendChild(u),r.appendChild(c),s.appendChild(r),s}}return window.__MS_SEARCH_CONFIG__&&(window.ghostMeilisearchSearch=new q(window.__MS_SEARCH_CONFIG__)),q.initialize=function(t){return window.ghostMeilisearchSearch||(window.ghostMeilisearchSearch=new q(t)),window.ghostMeilisearchSearch},q}));
//# sourceMappingURL=search.min.js.map
